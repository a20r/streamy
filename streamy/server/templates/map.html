<!DOCTYPE html>

<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.css">
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

    <style type="text/css">
        html { height: 100% }
        body { height: 100%; margin: 0; padding: 0 }
        #map-canvas { height: 100% }
    </style>

    <script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTML74DBnSbEOJSnThtpcF-F188TTd3DA&sensor=false">
    </script>

    <script type="text/javascript">
        function initialize() {
            var map_bounds = new google.maps.LatLngBounds();
            var map_options = { zoom: 1 };
            var map = new google.maps.Map(
                document.getElementById("map-canvas"),
                map_options
            );

            // DRAW POINTS
            var points = [
                {% for point in geo_points %}
                    [{{ point[0] }}, {{ point[1] }}],
                {% endfor %}
            ]

            for (var i in points) {
                var marker = new google.maps.Marker({
                    position: new google.maps.LatLng(points[i][0], points[i][1]),
                    map: map,
                    title:"Hello World!"
                });
                map_bounds.extend(new google.maps.LatLng(points[i][0], points[i][1]));
            }
            map.fitBounds(map_bounds);

            // CHANGE ZOOM IF NECESSARY AFTER BOUNDS HAVE CHANGED
            zoomChangeBoundsListener = google.maps.event.addListenerOnce(
                map,
                'bounds_changed',
                function(event) {
                    if (map.getZoom() > 12) {
                        map.setZoom(12);
                    }
                }
            );
            setTimeout(
                function(){
                    google.maps.event.removeListener(zoomChangeBoundsListener)
                }
                ,2000
            );
        }
        google.maps.event.addDomListener(window, 'load', initialize);

    </script>

    <style>
        #map-canvas {
            clear: both;
            width: auto;
            height: 500px;
            margin-top: 20px;
        }

        ul#search_menu {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        ul#search_menu li {
            padding: 0;
            margin: 0;
        }

        ul#rss_feeds {
            float: right;
        }

    </style>
    </head>
    <body>
        <!-- Fixed navbar -->

        <div class="container my-container">

          <!-- Main component for a primary marketing message or call to action -->
          <div class="jumbotron">
            <div class="row">
              <div class="col-sm-6 col-md-6">
                <a href="/landing.html"><img class="bannerimage" src="imgs/banner_trans.png"></img></a>
              </div>
              <div class="col-sm-6 col-md-3 col-md-offset-3">
              </div>
            </div>
          </div>

            <div >
                
                <div class="col-sm-12 col-md-5">
                <form id="search_menu" action="/map" method="post">
                    <div class="input-group">
                    
                        <input type="text" class="search-query form-control" placeholder="Search" name="search_term" id="search_term" value="Sochi">
                        <span class="input-group-btn">
                        <button type="submit" type="button"  class="btn btn-default">Search</button>
                        </span>
                    </div>
                </form>
                </div>

                <div class="row">
                <div class="col-sm-12 col-md-12">

                <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
                <script>
                    $(document).ready(function() {
                    });
                </script>


                <div id="map-canvas"></div>
                <ul id="rss_feeds">
                    {% for feed in rss %}
                    <li>
                        <a href="{{ feed.source_link }}">
                            [{{ feed.source }}] - {{ feed.title }}           
                        </a>
                    </li>
                    {% endfor %}

                </ul>
              </div>
              
            </div>
          </div>

        </div> <!-- /container -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.js"></script>
        <script>
            function searchUser() {
                var listOfUsernames = $("#userText").val().split(",").map(
                function(val) { 
                    return val.trim();
                });

                console.log(listOfUsernames);

                var totalRequested = 0;

                for (var i = 0; i < listOfUsernames.length; i++) {
                    $.getJSON("/twitter/" + listOfUsernames[i], function (json_ret) {
                        totalRequested++;
                        if (totalRequested == listOfUsernames.length) {
                            window.location.replace(
                                document.location.origin + "/streamer_list"
                            );
                        }

                    });
                }
            }
        </script>
    </body>
</html>

